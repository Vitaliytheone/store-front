var custom=new function(){var r=this;r.request=null,r.confirm=function(e,t,n,o,a){var r;return r=(0,templates["modal/confirm"])($.extend({},!0,{confirm_button:"OK",cancel_button:"Cancel",width:"600px"},n,{title:e,confirm_message:t})),$(window.document.body).append(r),$("#confirmModal").modal({}),$("#confirmModal").on("hidden.bs.modal",function(e){if($("#confirmModal").remove(),"function"==typeof a)return a.call()}),$("#confirm_yes").on("click",function(e){return $("#confirm_yes").unbind("click"),$("#confirmModal").modal("hide"),o.call()})},r.ajax=function(e){var t=$.extend({},!0,e);"object"==typeof e&&(e.beforeSend=function(){"function"==typeof t.beforeSend&&t.beforeSend()},e.success=function(e){"function"==typeof t.success&&t.success(e)},null!=r.request&&r.request.abort(),r.request=$.ajax(e))},r.notify=function(e){var t,n;if($("body").addClass("bottom-right"),"object"!=typeof e)return!1;for(t in e)void 0!==(n=$.extend({},!0,{type:"success",delay:8e3,text:""},e[t])).text&&null!=n.text&&$.notify({message:n.text.toString()},{type:n.type,placement:{from:"bottom",align:"right"},z_index:2e3,delay:n.delay,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})},r.sendBtn=function(t,n){if("object"!=typeof n&&(n={}),!t.hasClass("active")){t.addClass("has-spinner");var e=$.extend({},!0,n);e.url=t.attr("href"),$(".spinner",t).remove(),t.prepend('<span class="spinner"><i class="fa fa-spinner fa-spin"></i></span>'),e.beforeSend=function(){t.addClass("active")},e.success=function(e){t.removeClass("active"),$(".spinner",t).remove(),"success"==e.status?"function"==typeof n.callback&&n.callback(e):"error"==e.status&&r.notify({0:{type:"danger",text:e.message}})},r.ajax(e)}},r.sendFrom=function(t,n,o){if("object"!=typeof o&&(o={}),!t.hasClass("active")){t.addClass("has-spinner");var e=$.extend({},!0,o),a=$(".error-summary",n);e.url=n.attr("action"),e.type="POST",$(".spinner",t).remove(),t.prepend('<span class="spinner"><i class="fa fa-spinner fa-spin"></i></span>'),e.beforeSend=function(){t.addClass("active"),a.length&&(a.addClass("hidden"),a.html(""))},e.success=function(e){t.removeClass("active"),$(".spinner",t).remove(),"success"==e.status?"function"==typeof o.callback&&o.callback(e):"error"==e.status&&(e.message&&(a.length?(a.html(e.message),a.removeClass("hidden")):r.notify({0:{type:"danger",text:e.message}})),e.errors&&$.each(e.errors,function(e,t){alert(t),n.yiiActiveForm("updateAttribute",e,t)}),"function"==typeof o.errorCallback&&o.errorCallback(e))},r.ajax(e)}},r.generateUrlFromString=function(e){var t=e.replace(/[^a-z0-9_\-\s]/gim,"").replace(/\s+/g,"-").toLowerCase();return"-"!==t&&"_"!==t||(t=""),t},r.generateUniqueUrl=function(e,t){var n,o,a=e;for(o=1;(n=_.find(t,function(e){return e===a}))&&(a=e+"-"+o,o++),n;);return a}},customModule={};window.modules={},$(function(){"object"==typeof window.modules&&$.each(window.modules,function(e,t){void 0!==customModule[e]&&customModule[e].run(t)})});var templates={};templates["cart/hidden"]=_.template('<input class="fields" name="OrderForm[fields][<%= name %>]" value="<%= value %>" type="hidden" id="field-<%= name %>"/>'),templates["cart/input"]=_.template('<div class="form-group fields" id="order_<%= name %>">\n    <label class="control-label" for="orderform-<%= name %>"><%= label %></label>\n    <input class="form-control" name="OrderForm[fields][<%= name %>]" value="<%= value %>" type="text" id="field-<%= name %>">\n</div>'),templates["modal/confirm"]=_.template('<div class="modal fade confirm-modal" id="confirmModal" tabindex="-1" data-backdrop="static">\n    <div class="modal-dialog modal-md" role="document">\n        <div class="modal-content">\n            <% if (typeof(confirm_message) !== "undefined" && confirm_message != \'\') { %>\n            <div class="modal-header">\n                <h3 id="conrirm_label"><%= title %></h3>\n                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><span aria-hidden="true">&times;</span></button>\n            </div>\n\n            <div class="modal-body">\n                <p><%= confirm_message %></p>\n            </div>\n\n\n            <div class="modal-footer justify-content-start">\n                <button class="btn btn-primary m-btn--air" id="confirm_yes"><%= confirm_button %></button>\n                <button class="btn btn-secondary m-btn--air" data-dismiss="modal" aria-hidden="true"><%= cancel_button %></button>\n            </div>\n            <% } else { %>\n            <div class="modal-body">\n                <div class="text-center">\n                    <h3 id="conrirm_label"><%= title %></h3>\n                </div>\n\n                <div class="text-center">\n                    <button class="btn btn-primary m-btn--air" id="confirm_yes"><%= confirm_button %></button>\n                    <button class="btn btn-secondary m-btn--air" data-dismiss="modal" aria-hidden="true"><%= cancel_button %></button>\n                </div>\n            </div>\n            <% } %>\n        </div>\n    </div>\n</div>'),templates["admin/payments"]=_.template('<div class="form-group form-group-description">\n     <span class="fa fa-times remove-description"></span>\n    <label for="<%= elementId %>" class="control-label"><%= label %></label>\n    <input type="text" class="form-control <%= elementClass %>" name="<%= elementName %>" id="<%= elementId %>" value="">\n   </div>'),customModule.cartFrontend={fieldsOptions:void 0,fieldsContainer:void 0,cartTotal:void 0,run:function(e){var t=this;t.fieldsContainer=$("form"),t.fieldOptions=e.fieldOptions,t.cartTotal=e.cartTotal,void 0!==e.options&&(void 0!==e.options.authorize&&t.initAuthorize(e.options.authorize),void 0!==e.options.stripe&&t.initStripe(e.options.stripe),void 0!==e.options.stripe_3d_secure&&t.initStripe3dSecure(e.options.stripe_3d_secure)),$(document).on("change",'input[name="OrderForm[method]"]',function(){var e=$(this).val();t.updateFields(e)}),$('input[name="OrderForm[method]"]:checked').trigger("change")},updateFields:function(e){var t=this;if($("button[type=submit]",t.fieldsContainer).show(),$(".fields",t.fieldsContainer).remove(),$("input,select",t.fieldsContainer).prop("disabled",!1),void 0!==t.fieldOptions&&void 0!==t.fieldOptions[e]&&t.fieldOptions[e]){var n=[],o=templates["cart/input"],a=templates["cart/hidden"];$.each(t.fieldOptions[e],function(e,t){void 0!==t&&null!=t&&t&&("input"==t.type&&n.push(o(t)),"hidden"==t.type&&n.push(a(t)))}),$(".form-group",t.fieldsContainer).last().after(n.join("\r\n"))}},initAuthorize:function(t){var n=$('input[name="OrderForm[email]'),e=t.configure,o=$("button[type=submit]",this.fieldsContainer),a=$("<button />",e).hide();o.after(a),o.on("click",function(e){if(""!=$.trim(n.val()))return $('input[name="OrderForm[method]"]:checked').val()==t.type?(e.stopImmediatePropagation(),a.trigger("click"),$("body,html").animate({scrollTop:0},100),!1):void 0})},initStripe:function(o){var a=this,r=StripeCheckout.configure($.extend({},!0,o.configure,{token:function(e){$("#field-token").val(e.id),$("#field-email").val(e.email),a.fieldsContainer.submit()}}));$("button",a.fieldsContainer).on("click",function(e){if(o.type!=$('input[name="OrderForm[method]"]:checked').val())return!0;var t=!1;if($.ajax({url:a.fieldsContainer.attr("action")+"/validate",data:a.fieldsContainer.serialize(),async:!1,method:"POST",success:function(e){"success"==e.status&&(t=!0)}}),!t)return!0;var n=$.extend({},!0,o.open);return n.amount=100*$("#amount").val(),r.open(n),e.preventDefault(),!1}),$(window).on("popstate",function(){r.close()})},initStripe3dSecure:function(o){var a=this;if(Boolean(o.configure.key.trim()))var n=Stripe(o.configure.key),r=StripeCheckout.configure($.extend({},!0,o.configure,{token:function(e){n.createSource({type:"card",token:e.id}).then(function(e){e.error||!e.source?(console.log("ERROR!",e.error.message),window.location.replace(o.return_url)):function(e){if("not_supported"===e.card.three_d_secure)return console.log("This card does not support 3D Secure!"),window.location.replace(o.return_url);var t=o.return_url+"?method="+o.type+"&email="+$('input[name="OrderForm[email]').val();n.createSource({type:"three_d_secure",amount:100*a.cartTotal.amount,currency:a.cartTotal.currency,three_d_secure:{card:e.id},redirect:{return_url:t}}).then(function(e){e.error?(console.log("ERROR!",e.error.message),window.location.replace(o.return_url)):function(e){e.redirect&&e.redirect.failure_reason&&(console.log("REDIRECT ERROR!",e.redirect.failure_reason),window.location.replace(o.return_url));window.location.replace(e.redirect.url)}(e.source)})}(e.source)})}}));$("button",a.fieldsContainer).on("click",function(e){if(o.type!=$('input[name="OrderForm[method]"]:checked').val())return!0;var t=!1;if($.ajax({url:a.fieldsContainer.attr("action")+"/validate",data:a.fieldsContainer.serialize(),async:!1,method:"POST",success:function(e){"success"===e.status&&(t=!0)}}),!t)return!0;var n=$.extend({},!0,o.open);return n.amount=100*a.cartTotal.amount,n.currency=a.cartTotal.currency,r.open(n),e.preventDefault(),!1}),$(window).on("popstate",function(){r.close()})},responseAuthorizeHandler:function(e){if("Error"===e.messages.resultCode)for(var t=0;t<e.messages.message.length;)alert(e.messages.message[t].code+": "+e.messages.message[t].text),t+=1;else $("#field-data_descriptor").val(e.opaqueData.dataDescriptor),$("#field-data_value").val(e.opaqueData.dataValue),$("form").submit()}};var responseAuthorizeHandler=customModule.cartFrontend.responseAuthorizeHandler;