var custom=new function(){var e=this;e.request=null,e.confirm=function(e,t,o,n){var a;return a=(0,templates["modal/confirm"])($.extend({},!0,{confirm_button:"OK",cancel_button:"Cancel",width:"600px"},n,{title:e,confirm_message:t})),$(window.document.body).append(a),$("#confirmModal").modal({}),$("#confirmModal").on("hidden.bs.modal",function(e){$("#confirmModal").remove()}),$("#confirm_yes").on("click",function(e){return $("#confirm_yes").unbind("click"),$("#confirmModal").modal("hide"),o.call()})},e.ajax=function(t){var o=$.extend({},!0,t);"object"==typeof t&&(t.beforeSend=function(){"function"==typeof o.beforeSend&&o.beforeSend()},t.success=function(e){"function"==typeof o.success&&o.success(e)},null!=e.request&&e.request.abort(),e.request=$.ajax(t))},e.notify=function(e){var t,o;if($("body").addClass("bottom-right"),"object"!=typeof e)return!1;for(t in e)void 0!==(o=$.extend({},!0,{type:"success",delay:8e3,text:""},e[t])).text&&null!=o.text&&$.notify({message:o.text.toString()},{type:o.type,placement:{from:"bottom",align:"right"},z_index:2e3,delay:o.delay,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})},e.sendBtn=function(t,o){if("object"!=typeof o&&(o={}),!t.hasClass("active")){t.addClass("has-spinner");var n=$.extend({},!0,o);n.url=t.attr("href"),$(".spinner",t).remove(),t.prepend('<span class="spinner"><i class="fa fa-spinner fa-spin"></i></span>'),n.beforeSend=function(){t.addClass("active")},n.success=function(n){t.removeClass("active"),$(".spinner",t).remove(),"success"==n.status?"function"==typeof o.callback&&o.callback(n):"error"==n.status&&e.notify({0:{type:"danger",text:n.message}})},e.ajax(n)}},e.sendFrom=function(t,o,n){if("object"!=typeof n&&(n={}),!t.hasClass("active")){t.addClass("has-spinner");var a=$.extend({},!0,n),r=$(".error-summary",o);a.url=o.attr("action"),a.type="POST",$(".spinner",t).remove(),t.prepend('<span class="spinner"><i class="fa fa-spinner fa-spin"></i></span>'),a.beforeSend=function(){t.addClass("active"),r.length&&(r.addClass("hidden"),r.html(""))},a.success=function(a){t.removeClass("active"),$(".spinner",t).remove(),"success"==a.status?"function"==typeof n.callback&&n.callback(a):"error"==a.status&&(a.message&&(r.length?(r.html(a.message),r.removeClass("hidden")):e.notify({0:{type:"danger",text:a.message}})),a.errors&&$.each(a.errors,function(e,t){alert(t),o.yiiActiveForm("updateAttribute",e,t)}),"function"==typeof n.errorCallback&&n.errorCallback(a))},e.ajax(a)}},e.generateUrlFromString=function(e){return e.replace(/[^a-z0-9_\-\s]/gim,"").replace(/\s+/g,"-").toLowerCase()},e.generateUniqueUrl=function(e,t){var o,n,a=e;n=1;do{(o=_.find(t,function(e){return e===a}))&&(a=e+"-"+n,n++)}while(o);return a}},customModule={};window.modules={},$(function(){"object"==typeof window.modules&&$.each(window.modules,function(e,t){void 0!==customModule[e]&&customModule[e].run(t)})}),customModule.adminGeneral={run:function(e){$(".edit-seo__title").length>0&&function(){for(var e=$("#store-name"),t=$("#edit-seo__title"),o=t.val(),n=!1,a=["edit-seo__title","edit-seo__meta"],r=0;r<a.length;r++)!function(e){$("."+a[e]+"-muted").text($("#"+a[e]).val().length),$("#"+a[e]).on("input",function(t){$("."+a[e]+"-muted").text($(t.target).val().length),$("."+a[e]).text($(t.target).val())}).trigger("input")}(r);t.on("focus",function(e){n=!0}),e.on("input",function(e){""!==o||n||t.val($(this).val()).trigger("input")})}();var t=$("#delete-modal"),o=t.find("#delete-image");t.on("show.bs.modal",function(e){var t=$(e.relatedTarget).attr("href");o.attr("href",t)}),t.on("hidden.bs.modal",function(){o.attr("href",null)})}},customModule.adminPages={run:function(e){var t,o,n=$("#delete-modal"),a=n.find(".modal-loader");n.find("#feature-delete").on("click",function(){a.removeClass("hidden"),$.ajax({url:t,type:"DELETE",success:function(e,t,n){_.delay(function(){$(location).attr("href",o)},500)},error:function(e,t,o){a.addClass("hidden"),n.modal("hide"),console.log("Error on service save",e,t,o)}})}),n.on("show.bs.modal",function(e){var a=$(e.relatedTarget);t=a.data("action_url"),o=n.data("success_redirect")}),n.on("hidden.bs.modal",function(){t=null})}},customModule.adminPageEdit={run:function(e){function t(e){var t,o=$(e.target).val();t=custom.generateUrlFromString(o),t=custom.generateUniqueUrl(t,s),i.url.val(t).trigger("input"),i.seo_title.val(o).trigger("input")}function o(){i.name.off("input",t),i.seo_title.off("input",t)}var n=$("#pageForm"),a=n.find(".collapse"),r=n.data("new_page"),i={name:n.find(".form_field__name"),content:n.find(".form_field__content"),url:n.find(".form_field__url"),visibility:n.find(".form_field__visibility"),seo_title:n.find(".form_field__seo_title"),seo_description:n.find(".form_field__seo_description")},s=e.urls||[],d=e.url_error||!1;$(".edit-seo__title").length>0&&function(){for(var e=["edit-seo__title","edit-seo__meta","edit-seo__url"],t=0;t<e.length;t++)!function(t){$("."+e[t]+"-muted").text($("#"+e[t]).val().length),$("#"+e[t]).on("input",function(o){2===t?$("."+e[t]).text($(o.target).val().toLowerCase()):($("."+e[t]+"-muted").text($(o.target).val().length),$("."+e[t]).text($(o.target).val()))}).trigger("input")}(t)}(),i.content,i.content.summernote({minHeight:300,focus:!0,toolbar:[["style",["style","bold","italic"]],["lists",["ul","ol"]],["para",["paragraph"]],["color",["color"]],["insert",["link","picture","video"]],["codeview",["codeview"]]],disableDragAndDrop:!0,styleTags:["p","h1","h2","h3","h4","h5","h6"],popover:{image:[["float",["floatLeft","floatRight","floatNone"]],["remove",["removeMedia"]]]},dialogsFade:!0}),n.keypress(function(e){if(13===e.which)return n.submit(),!1}),d&&a.collapse("show"),r&&(i.name.focus(),i.name.on("input",t),i.url.on("focus",o),i.seo_title.on("focus",o)),i.url.on("input",function(e){var t,o=e.currentTarget,n=$(o),a=n.val(),r=o.selectionStart;(t=custom.generateUrlFromString(a)).length>=200&&(t=t.substring(0,199)),n.val(t),o.selectionEnd=r})}},customModule.adminPayments={run:function(e){$(document).on("change",".toggle-active",function(e){var t=$(e.currentTarget),o=t.data("action_url"),n=(t.data("payment_method"),0|t.prop("checked"));$.ajax({url:o,type:"POST",data:{active:n},success:function(e,t,o){},error:function(e,t,o){console.log("Error on update",e,t,o)}})})}},customModule.adminThemes={run:function(e){var t,o,n=$("#codemirror"),a=$("#modal_submit_close"),r=$("#modal_submit_reset");n.length>0&&(t=CodeMirror.fromTextArea(n[0],{lineNumbers:!0}),o=t.getValue());var i=$("#m_tree_1");i.jstree({core:{themes:{responsive:!1}},types:{default:{icon:"fa fa-folder"},file:{icon:"fa fa-file"}},plugins:["types"]}),i.on("select_node.jstree",function(e,t){var o=t.node;o&&o.hasOwnProperty("a_attr")&&"#"!==o.a_attr.href&&(window.location=o.a_attr.href)}),a.on("show.bs.modal",function(e){var n=$(e.relatedTarget).attr("href");if(void 0===t||t.getValue()===o)return e.stopPropagation(),window.location.href=n,!1;$(this).find(".submit_button").attr("href",n)}),r.on("show.bs.modal",function(e){var t=$(e.relatedTarget).attr("href");$(this).find(".submit_button").attr("href",t)})}},customModule.adminLayout={run:function(e){$(".dropdown-collapse").on("click",function(e){e.preventDefault(),e.stopPropagation(),$(this).next().hasClass("show")?$($(this).attr("href")).collapse("hide"):$($(this).attr("href")).collapse("show")});var t=document.querySelectorAll(".inputfile");Array.prototype.forEach.call(t,function(e){e.nextElementSibling.innerHTML;e.addEventListener("change",function(e){if((this.files&&this.files.length>1?(this.getAttribute("data-multiple-caption")||"").replace("{count}",this.files.length):e.target.value.split("\\").pop())&&this.files&&this.files[0]){var t=new FileReader;t.onload=function(e){var t='<div class="sommerce-settings__theme-imagepreview">\n                              <a href="#" class="sommerce-settings__delete-image"><span class="fa fa-times-circle-o"></span></a>\n                              <img src="'+e.target.result+'" alt="...">\n                          </div>';$("#image-preview").html(t)},t.readAsDataURL(this.files[0])}}),$(document).on("click",".sommerce_v1.0-settings__delete-image",function(t){$("#image-preview").html("<span></span>"),e.value=""})}),$('[data-toggle="tooltip"]').tooltip()}},customModule.adminNotifyLayout={run:function(e){toastr.options={closeButton:!1,debug:!1,newestOnTop:!1,progressBar:!1,positionClass:"toast-bottom-right",preventDuplicates:!1,onclick:null,showDuration:"300",hideDuration:"5000",timeOut:"5000",extendedTimeOut:"5000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};e.messages;e.messages&&_.forEach(e.messages,function(e){e.success&&toastr.success(e.success),e.warning&&toastr.warning(e.warning),e.error&&toastr.error(e.error)})}},customModule.ordersDetails={run:function(e){$(document).ready(function(){var e=$("#suborder-details-modal"),t=e.find(".modal-title"),o=e.find("#order-detail-provider"),n=e.find("#order-detail-provider-order-id"),a=e.find("#order-detail-provider-response"),r=e.find("#order-detail-lastupdate"),i=e.find(".modal-loader");e.on("show.bs.modal",function(e){function s(e){t.html(c),o.val(e.provider),n.val(e.provider_order_id),a.html(e.provider_response),r.val(e.updated_at)}var d=$(e.relatedTarget),l=d.data("suborder-id"),c=d.data("modal_title");void 0===l||isNaN(l)||(i.removeClass("hidden"),$.ajax({url:"/admin/orders/get-order-details",type:"GET",data:{suborder_id:l},success:function(e){i.addClass("hidden"),void 0!==e.details&&s(e.details)},error:function(e,t,o){console.log("Something is wrong!"),console.log(e,t,o),i.addClass("hidden")}}))}),e.on("hidden.bs.modal",function(e){$(e.currentTarget).find("input").val(""),a.html("")})})}},customModule.ordersClipboard={run:function(e){var t=e.messageCopied||"Copied!";$(document).ready(function(){var e=function(){var e=function(){new Clipboard("[data-clipboard=true]").on("success",function(e){e.clearSelection(),void 0===toastr?alert("Copied!"):(toastr.options={positionClass:"toast-bottom-right"},toastr.success(t))})};return{init:function(){e()}}}();jQuery(document).ready(function(){e.init()})})}},customModule.payments={run:function(e){var t=$(".payments_detail"),o=t.find(".modal-title"),n=t.find(".details-container"),a=t.find(".modal-loader");t.on("show.bs.modal",function(e){function r(e){o.html(d),_.each(e,function(e){n.append('<pre class="sommerce-pre details-item">'+e.time+"<br><br>"+e.data+"</pre>")})}var i=$(e.relatedTarget),s=i.data("id"),d=i.data("modal_title"),l=i.data("action_url");void 0!==s&&void 0!==l&&(a.removeClass("hidden"),$.ajax({url:l,type:"GET",success:function(e){a.addClass("hidden"),void 0!==e&&r(e)},error:function(e,o,n){console.log("Something is wrong!"),console.log(e,o,n),a.addClass("hidden"),t.modal("hide")}}))}),t.on("hidden.bs.modal",function(e){o.html(""),n.empty()})}},customModule.adminProviders={run:function(e){$(document).on("click","#showCreateProviderModal",function(e){e.preventDefault();$(this);var t=$("#createProviderModal"),o=$("#createProviderForm",t),n=$("#createProviderError",o);return n.addClass("hidden"),n.html(""),t.modal("show"),!1}),$(document).on("click","#createProviderButton",function(e){e.preventDefault();var t=$(this),o=$("#createProviderForm");return custom.sendFrom(t,o,{data:o.serialize(),callback:function(e){$("#createProviderModal").modal("hide"),location.reload()}}),!1})}};